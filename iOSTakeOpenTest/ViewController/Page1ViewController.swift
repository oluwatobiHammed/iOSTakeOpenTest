//
//  ViewController.swift
//  iOSTakeOpenTest
//
//  Created by Oladipupo Oluwatobi on 09/06/2020.
//  Copyright Â© 2020 Oladipupo Oluwatobi. All rights reserved.
//

import UIKit

class Page1ViewController: BaseTableviewController {
    @IBOutlet weak var nextButton: UIButton!
    @IBOutlet weak var headerTitleLabel: UILabel!

    var isTrue = Bool()
    var name  = Bool()
    var phone = Bool()
    var email = Bool()
    var dob = Bool()
    var contrain = Bool()
    var firstSection = [Sections]()
    override func viewDidLoad() {
        super.viewDidLoad()
        nextButton.layer.cornerRadius = 7
        nextButton.isEnabled = false
        nextButton.alpha = 0.7
       
        
    }
 

   
    override func doLoadData(callback: @escaping (([Any]) -> Void)) {
          if let data = DataLoader().userData?.pages?[0].sections {
                  callback(data)
                  headerTitleLabel.text = data[0].label
              }
    }

    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(animated)
        navigationController?.setNavigationBarHidden(true, animated: false)
    }
    
    override func viewDidDisappear(_ animated: Bool) {
        navigationController?.setNavigationBarHidden(false, animated: true)
    }

    override func parameterBuilder () {
        let builder = FormBuilder.Builder()
        for i in 0..<arrayOfCells.count {
            
            if arrayOfCells[i].data.label == "Email address" {
                if let email = arrayOfCells[i].textField.text{
                    builder.email = email
                }
                
            }
            if arrayOfCells[i].data.label == "Your fullname" {
                if let fullname = arrayOfCells[i].textField.text{
                    builder.fullname = fullname
                }
                
            }
            
            if arrayOfCells[i].data.label == "Phone Number" {
                if let phonenumber = arrayOfCells[i].textField.text{
                    builder.phoneNumber = phonenumber
                }
                
            }
            
            if arrayOfCells[i].data.label == "Date of Birth" {
                if let dob = arrayOfCells[i].textField.text{
                    builder.dob = dob
                }
                
            }
        }
        
        let _ = StoryBoardsID.boardMain.navigationProvider.requestNavigation(to: ViewControllerID.Page2ViewController.rawValue, from: self, requestData: builder)
    }
    override func istoValidate() {
        for i in 0..<arrayOfCells.count {
               
            if arrayOfCells[i].data.isMandatory == true && arrayOfCells[i].textField.hasText != true && arrayOfCells[i].pickView.hasText != true  {
                arrayOfCells[i].errorLabel.alpha = 1
                arrayOfCells[i].pickerErrorLabel.alpha = 0
                self.arrayOfCells[i].errorLabel.textWithAnimation(text: "This field is required" , duration: 0.9)
                 if  arrayOfCells[i].data.label ==  "Date of Birth" {
                    arrayOfCells[i].errorLabel.alpha = 0
                    arrayOfCells[i].pickerErrorLabel.alpha = 1
                   self.arrayOfCells[i].pickerErrorLabel.textWithAnimation(text: "This field is required" , duration: 0.9)
                }
                
            }else {
                
                if arrayOfCells[i].data.label ==  "Email address" {
                    arrayOfCells[i].errorLabel.alpha = 1
                    if let email = arrayOfCells[i].textField.text{
                        let isValid = arrayOfCells[i].isValidEmail(email)
                        let error = isValid ? "" : "Email is not valid"
                        self.arrayOfCells[i].errorLabel.textWithAnimation(text: error , duration: 0.9)
                        self.arrayOfCells[i].errorLabel.layoutIfNeeded()
                    }
                    
                }
                
                if arrayOfCells[i].data.label ==  "Phone Number"{
                    arrayOfCells[i].errorLabel.alpha = 1
                    
                    let checkNumber = arrayOfCells[i].numberCheck()
                    let error = checkNumber ? "" : "Must contain exactly 11 charaters"
                    self.arrayOfCells[i].errorLabel.textWithAnimation(text: error , duration: 0.9)
                    self.arrayOfCells[i].errorLabel.layoutIfNeeded()
                }
                
                
            }
            if arrayOfCells[i].data.label ==  "Email address" {
                print("This is the email ",arrayOfCells[i].validate)
                if arrayOfCells[i].validate == true {
                    email = true
                }else {
                    email = false
                }
                
            }
            if arrayOfCells[i].data.label ==  "Phone Number"{
                if arrayOfCells[i].validateOther == true {
                    phone = true
                }else{
                    phone = false
                }
                
            }
            
            if  arrayOfCells[i].data.label ==  "Your fullname" {
                print("This is the name ",arrayOfCells[i].nameValidator)
                if arrayOfCells[i].nameValidator == true {
                    name = true
                }else {
                    name = false
                }
                
            }
            
            if  arrayOfCells[i].data.label ==  "Date of Birth" {
                print("This is the dob",arrayOfCells[i].dobValidator)
                if arrayOfCells[i].dobValidator == true {
                    dob = true
                }else {
                    dob = false
                }
                
            }
            if phone == true && name == true && email == true && dob == true  {
                isTrue = true
                
            }else {
                isTrue = false
            }
            print("This actual value",isTrue)
            if isTrue == true {
                nextButton.alpha = 1
                self.nextButton.isEnabled = true
            }else{
                
                nextButton.alpha = 0.7
                self.nextButton.isEnabled = false
            }
            
            
        }
    }
    
    
    @IBAction func btnStart(_ sender: UIButton) {
        parameterBuilder()
        
    }
    
    
}



